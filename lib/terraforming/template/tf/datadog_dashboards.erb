<% dashboards.each do |dashboard| -%>
<%- options = options_of(dashboard) -%>
resource "datadog_dashboard" "<%= resource_name_of(dashboard) %>" {
  title       = "<%= dashboard["title"] %>"
  description = "<%= dashboard["description"] %>"
  read_only   = <%= dashboard["read_only"] %>

  <%- options["graphs"].each do |k, v| -%>
  graph {
    title = "Redis latency (ms)"
    viz   = "timeseries"

    request {
      q    = "avg:redis.info.latency_ms{$host}"
      type = "bars"
    }
  }
  <%- end -%>

  template_variable {
    name   = "host"
    prefix = "host"
  }
}
<%- end -%>
